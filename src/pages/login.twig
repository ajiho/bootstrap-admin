{% extends "layout/base.twig" %}

{% block content %}
  <div class="d-flex align-items-center justify-content-center">
    <div style="width: 400px;max-width: 100%;margin-top: 12vh;" class="p-2">
      <h2 class="text-center">bootstrap-admin</h2>
      <p class="text-secondary text-center">基于bootstrap5.1.3设计的后台管理模板系统</p>
      <form id="form" class="form">
        <div class="mb-3">
          <div class="input-group">
            <span class="input-group-text bg-white "><i class="bi bi-person"></i></span>
            <input type="text" class="form-control" placeholder="请输入用户" name="username"
                   id="username" aria-label="username">
          </div>
        </div>
        <div class="mb-3">
          <div class="input-group">
            <span class="input-group-text bg-white"><i class="bi bi-person-lock"></i></span>
            <input type="password" class="form-control bsa-toggle-input" placeholder="请输入密码"
                   name="password"
                   autocomplete="off"
                   id="password" aria-label="password">
            <span class="input-group-text bg-white bsa-cursor-pointer bsa-toggle-input-trigger"><i
                class="bi bi-eye-slash"></i></span>
          </div>
        </div>

        <div class="mb-3">
          <div class="input-group">
            <span class="input-group-text bg-white"><i class="bi bi-shield-lock"></i></span>
            <input type="text" class="form-control" id="captcha" name="captcha" aria-label="captcha"
                   placeholder="请输入验证码" style="min-width: 80px">
            <img src="img/captcha.gif" alt="验证码"
                 class="bsa-cursor-pointer" style="height: 38px;width: 120px"/>
          </div>
        </div>

        <div class="mb-3 d-flex align-items-center justify-content-between flex-wrap gap-3 ">
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="exampleCheck1" name="remember"
                   value="1">
            <label class="form-check-label" for="exampleCheck1">十天内免登录</label>
          </div>
          <a href="javascript:" class="link-success text-decoration-none">忘记密码?</a>
        </div>

        <div class="d-grid gap-2">
          <button class="btn btn-outline-success" type="submit"><i class="bi bi-box-arrow-in-right"></i> 登入</button>
        </div>

      </form>
    </div>
  </div>
{% endblock %}


{% block js %}
  <script src="lib/formvalidation/js/formValidation.js"></script>
  <script src="lib/formvalidation/js/framework/bootstrap.js"></script>
  <script src="lib/formvalidation/js/language/zh_CN.js"></script>
  <script>

    $(document).ready(function () {
      //前端表单验证
      $('#form').formValidation({
        fields: {
          username: {
            validators: {
              notEmpty: true,
            }
          },
          password: {
            validators: {
              notEmpty: true,
            }
          },
          captcha: {
            validators: {
              notEmpty: true,
            }
          }
        }
      }).on('success.form.fv', function (e) {
        //阻止表单提交
        e.preventDefault();

        //得到表单对象
        const $form = $(e.target);
        //获取数据
        const data = $form.serialize();

        //发起ajax请求
        $.ajax({
          method: 'post',
          url: '/login',
          //表单数据
          data: data,
        }).then(response => {
          if (response.code === 200) {

            layer.msg('登录成功', {time: 800,icon:1},()=>location.replace('index.html'));
          }
        });
      });



      //密码框的显示和隐藏
      $(document).on('click', '.bsa-toggle-input-trigger', function (event) {
        event.preventDefault();
        const $input = $('.bsa-toggle-input');
        const $trigger = $('.bsa-toggle-input-trigger');
        if ($input.attr('type') === 'text') {
          $input.attr('type', 'password');
          $trigger.html('<i class="bi bi-eye-slash"></i>')
        } else if ($input.attr('type') === 'password') {
          $input.attr('type', 'text');
          $trigger.html('<i class="bi bi-eye"></i>')
        }
      });
    })
  </script>
{% endblock %}
